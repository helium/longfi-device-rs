language: rust

env:
 global:
   - RUST_BACKTRACE=1

rust:
  - stable

matrix:
  fast_finish: true
  allow_failures:
    - rust: nightly

before_script:
  - sudo apt-get update
  - sudo apt-get install gcc-arm-none-eabi g++-multilib libc6-dev-i386 libnewlib-arm-none-eabi
  - wget https://launchpad.net/ubuntu/+archive/primary/+files/gcc-arm-none-eabi_7-2018-q2-6_amd64.deb -O /tmp/gcc-arm-none-eabi_7-2018-q2-6_amd64.deb
  - sudo dpkg -i /tmp/gcc-arm-none-eabi_7-2018-q2-6_amd64.deb
  - rustup target add thumbv6m-none-eabi
  - rustup component add rustfmt
  - rustup component add clippy
  - rustup component add clippy --toolchain stable-x86_64-unknown-linux-gnu

script:
  - cargo build
  - cargo build --example stm32l0x2
  - cargo build --example stm32l0x2 --release
  - cargo clippy -- -D clippy::all
  - cargo fmt -- --check
